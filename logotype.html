<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
    <style>
        .profile-container {
            display: flex;
            align-items: center;
            padding: 10px;
            background-color: #f2f2f2;
        }
        .profile-info {
            display: flex;
            align-items: center;
            margin-left: auto;
        }
        .profile-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .profile-name {
            font-size: 14px;
        }
        .profile-balance {
            display: flex;
            align-items: center;
            padding: 5px;
            border-radius: 5px;
            background-color: #ffffff;
            cursor: pointer;
            margin-right: 10px;
        }
        .balance-icon {
            width: 37px;
            height: 37px;
            margin-right: 5px;
            filter: none;
        }
        .profile-balance:hover .balance-icon {
            filter: grayscale(100%);
        }
        .balance-text {
            font-size: 14px;
			font-face: Arial;
        }
        .profile-dropdown {
            position: relative;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background-color: #f9f9f9;
            min-width: 120px;
            padding: 5px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        }
        .dropdown-content a {
            display: flex;
            align-items: center;
            padding: 5px;
            text-decoration: none;
            color: #333;
        }
        .dropdown-content a:hover {
            background-color: #ddd;
        }
        .dropdown-button {
            padding: 5px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            background-color: transparent;
        }
        .dropdown-icon {
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
		.dark-theme {
            background-color: #333;
            color: #fff;
        }
		.dark-theme font {
            background-color: #333;
            color: #fff;
        }
		.dark-theme a {
            background-color: #333;
            color: #fff;
        }
		.dark-theme div {
            background-color: #333;
            color: #fff;
        }
    </style>
    <script>
	// Шаг 1: Получить имя пользователя из localStorage
	var user = localStorage.getItem('user');
	if (user) {
		var userName = JSON.parse(user).name;

		// Шаг 2: Сделать GET-запрос к серверу, чтобы получить данные игрока по имени
		var apiUrl = 'https://6455f3055f9a4f2361374d32.mockapi.io/api/v1/prefiles?search=' + userName;

		fetch(apiUrl)
			.then(response => response.json())
			.then(data => {
				if (data.length > 0) {
					// Шаг 3: Обновить данные в localStorage данными игрока
					localStorage.setItem('user', JSON.stringify(data[0]));
					console.log('Данные игрока обновлены в localStorage.');
				} else {
					console.log('Игрок с именем ' + userName + ' не найден.');
				}
			})
			.catch(error => {
				console.error('Ошибка при выполнении GET-запроса:', error);
			});
	} else {
		console.log('Имя пользователя не найдено в localStorage.');
	}



	
	
	// Получение имени пользователя из localStorage
var user = localStorage.getItem('user');

// Если пользователя нет в localStorage, перенаправляем на страницу регистрации
if (!user) {
    //top.location.href = 'https://sashabeliisr.github.io/launc/';
} else {
    // Пробуем найти пользователя на сервере
    var userName = JSON.parse(user).name;
    var userFound = false;
    var userBanInfo = "";

    // Запрос к серверу для поиска пользователя
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            var prefiles = JSON.parse(this.responseText);
            for (var i = 0; i < prefiles.length; i++) {
                if (prefiles[i].name === userName) {
                    userFound = true;
                    if (prefiles[i].Banned) {
                        // Перенаправляем на страницу banned.html
                        top.location.href = 'banned.html';
                    }
                    break;
                }
            }
            if (!userFound) {
                userBanInfo = "<p>Пользователь не найден</p>";
            }
            document.getElementById('ban-info').innerHTML = userBanInfo;
        }
    };
    xhttp.open("GET", "https://6455f3055f9a4f2361374d32.mockapi.io/api/v1/prefiles", true);
    xhttp.send();
}


	
	
	
    document.addEventListener('DOMContentLoaded', function() {
        var user = JSON.parse(localStorage.getItem('user'));

        if (user && user.name) {
            var profileName = document.getElementById('profile-name');
            var profileAvatar = document.getElementById('profile-avatar');
            var profileBalance = document.getElementById('profile-balance');
            var balanceText = document.getElementById('balance-text');
			var profileId = document.getElementById('profileId');

            profileName.textContent = user.name;

            // Запрос на сервер для получения иконки пользователя
            fetch('https://6455f3055f9a4f2361374d32.mockapi.io/prefiles')
                .then(response => response.json())
                .then(data => {
                    var currentUser = data.find(item => item.name === user.name);
                    if (currentUser && currentUser.avatar) {
                        profileAvatar.src = currentUser.avatar;
						profileId.textContent = ' Id: ' + currentUser.id; // Добавлено
                        document.getElementById('profile-container').style.display = 'flex';
                    }
                })
                .catch(error => {
                    console.error('Error fetching user avatar:', error);
                });

            // Запрос на сервер для получения баланса пользователя
            fetch('https://6455f3055f9a4f2361374d32.mockapi.io/prefiles')
                .then(response => response.json())
                .then(data => {
                    var currentUser = data.find(item => item.name === user.name);
                    if (currentUser && currentUser.balance) {
                        var balance = currentUser.balance;
                        balanceText.textContent = balance;
                        profileBalance.addEventListener('click', function() {
                            window.parent.frames['Main'].location.href = 'buylauncs.html';
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching user balance:', error);
                });
        }
    });

    function toggleDropdown() {
        var dropdownContent = document.getElementById('dropdown-content');
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    }

    function openSettings() {
        var frame = window.parent.frames['Main'];
        frame.location.href = 'settings.html';
    }

    function logout() {
        localStorage.removeItem('user');
        // Redirect to logout page
        // window.location.href = 'logout.html';
    }
    </script>
</head>
<body>
    <div class="profile-container">
		<a href="buylauncs.html" target="Main">
        <div class="profile-balance" id="profile-balance">
            <img class="balance-icon" src="photo/money.png" alt="Money"></a>
            <span id="balance-text" class="balance-text"></span>
        </div>
        <div class="profile-info">
			<a href="loginin.html" target="Main" style="color: black; font-family: Arial; text-decoration: none;">Login</a><p>ㅤ</p>
            <img id="profile-avatar" class="profile-avatar" src="" alt="User Avatar">
			<span id="profileId" class="profile-id"></span> <!-- Добавлено -->
			<p>ㅤ</p>
            <span id="profile-name" class="profile-name"></span>
        </div>
        <div class="profile-dropdown">
            <button class="dropdown-button" onclick="toggleDropdown()">&#9662;</button>
            <div id="dropdown-content" class="dropdown-content">
                <a href="#" onclick="openSettings()"><img class="dropdown-icon" src="photo/settings.png" alt="Настройки">Settings</a>
                <a href="#" onclick="logout()"><img class="dropdown-icon" src="photo/back.png" alt="Выход">Login out</a>
            </div>
        </div>
    </div>
	<script>
        // Загружаем текущую тему из Local Storage при загрузке страницы
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
        }
    </script>
</body>
</html>
